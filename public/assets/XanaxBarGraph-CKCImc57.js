import{j as d,a as A}from"./index-BypqA20B.js";import{r as b}from"./vendor-react-BGsnWRWU.js";import{u as Y}from"./useChartTheme-0-n_Utvk.js";import{d as Z,C as _,a as $,L as z,B as F,b as G,P as N,e as P,p as H,c as q,i as J}from"./vendor-chart-BMU4AhuH.js";import"./chartTheme-DLOnjtYC.js";_.register($,z,F,G,N,P,H,q,J);function at({logsUpdated:T,darkMode:l,chartHeight:U=400,dateFrom:h,dateTo:x,onMinDate:w}){const[y,k]=b.useState({labels:[],counts2290:[],counts2291:[],cumulative2290:[],average2290:0}),[D,O]=b.useState({labels:[],counts2290:[],counts2291:[]}),[p,B]=b.useState("daily"),[E,W]=b.useState(!0),[K,X]=b.useState(null),{themedOptions:I}=Y(l);b.useEffect(()=>{async function r(){const m=await A(2290),i={};for(const e of m){const t=new Date(e.timestamp*1e3).toISOString().slice(0,10);i[t]=(i[t]||0)+1}const a=await A(2291),n={};for(const e of a){const t=new Date(e.timestamp*1e3).toISOString().slice(0,10);n[t]=(n[t]||0)+1}const o=Array.from(new Set([...Object.keys(i),...Object.keys(n)])).sort(),g=o.map(e=>i[e]||0),f=o.map(e=>n[e]||0);O({labels:o,counts2290:g,counts2291:f});const C=g.reduce((e,t)=>e+t,0);X(C),S("daily",{labels:o,counts2290:g,counts2291:f})}r()},[T]);function S(r,m){const i=m||D;if(!i.labels.length)return;let a=i;if(h||x){const e=[],t=[],u=[];for(let s=0;s<i.labels.length;s++){const c=i.labels[s];h&&c<h||x&&c>x||(e.push(c),t.push(i.counts2290[s]),u.push(i.counts2291[s]))}a={labels:e,counts2290:t,counts2291:u}}if(a.labels.length&&w&&/^\d{4}-\d{2}-\d{2}$/.test(a.labels[0]))try{w(a.labels[0])}catch{}let n=[],o=[],g=[];if(r==="daily")n=a.labels,o=a.counts2290,g=a.counts2291;else if(r==="weekly"){const e=new Map;for(let t=0;t<a.labels.length;t++){const u=a.labels[t],s=new Date(u+"T00:00:00Z"),c=new Date(Date.UTC(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()));c.setUTCDate(c.getUTCDate()+4-(c.getUTCDay()||7));const L=new Date(Date.UTC(c.getUTCFullYear(),0,1)),R=Math.ceil(((c-L)/864e5+1)/7),j=`${c.getUTCFullYear()}-W${String(R).padStart(2,"0")}`,v=e.get(j)||{xanax:0,od:0};v.xanax+=a.counts2290[t],v.od+=a.counts2291[t],e.set(j,v)}n=Array.from(e.keys()),o=n.map(t=>e.get(t).xanax),g=n.map(t=>e.get(t).od)}else if(r==="monthly"){const e=new Map;for(let t=0;t<a.labels.length;t++){const u=a.labels[t].slice(0,7),s=e.get(u)||{xanax:0,od:0};s.xanax+=a.counts2290[t],s.od+=a.counts2291[t],e.set(u,s)}n=Array.from(e.keys()),o=n.map(t=>e.get(t).xanax),g=n.map(t=>e.get(t).od)}const f=[];o.reduce((e,t,u)=>{const s=e+t;return f[u]=s,s},0);const C=o.length?o.reduce((e,t)=>e+t,0)/o.length:0;k({labels:n,counts2290:o,counts2291:g,cumulative2290:f,average2290:C})}return b.useEffect(()=>{S(p)},[p,D]),d.jsxs("div",{className:"my-4",children:[d.jsxs("h5",{style:{cursor:"pointer",userSelect:"none"},onClick:()=>W(r=>!r),title:"Click to show/hide chart",children:["Xanax taken (",p,") and Overdoses"]}),E&&d.jsx(d.Fragment,{children:d.jsxs("div",{style:{position:"relative",height:U},children:[d.jsx("div",{style:{position:"absolute",left:0,top:0,bottom:0,display:"flex",flexDirection:"column",gap:6,padding:"4px 4px",zIndex:5},children:["daily","weekly","monthly"].map(r=>d.jsx("button",{onClick:()=>B(r),style:{writingMode:"vertical-rl",transform:"rotate(180deg)",background:p===r?l?"#555":"#ddd":l?"#333":"#f5f5f5",color:l?"#fff":"#222",border:"1px solid "+(l?"#777":"#ccc"),borderRadius:4,cursor:"pointer",fontSize:11,padding:"6px 4px"},children:r},r))}),d.jsx("div",{style:{height:"100%",marginLeft:40},children:d.jsx(Z,{data:{labels:y.labels,datasets:[{label:"Xanax",data:y.counts2290,backgroundColor:l?"rgba(170,150,255,0.75)":"rgba(37, 22, 68, 0.94)",borderColor:l?"rgba(195,175,255,1)":"rgba(46, 26, 85, 1)",borderWidth:1},{label:"Overdoses",data:y.counts2291,backgroundColor:l?"rgba(255,120,120,0.85)":"rgba(255, 0, 0, 1)",borderColor:l?"rgba(255,150,150,1)":"rgba(255,0,0,1)",borderWidth:1},{type:"line",label:"Average Xanax",data:y.labels.map(()=>y.average2290),borderColor:l?"#66e0ff":"#0288d1",backgroundColor:"transparent",borderWidth:2,borderDash:[6,4],pointRadius:0,tension:0,yAxisID:"y",order:2},{type:"line",label:"Cumulative Xanax",data:y.cumulative2290,borderColor:l?"#ffd666":"#ff9800",backgroundColor:l?"rgba(255,214,102,0.15)":"rgba(255,152,0,0.15)",borderWidth:2,tension:.25,yAxisID:"y2",pointRadius:2,pointHoverRadius:4,fill:!0,order:3}]},options:I({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0},title:{display:!1}},scales:{x:{title:{display:!0,text:p==="daily"?"Day":p==="weekly"?"Week":"Month"}},y:{title:{display:!0,text:"Count ("+p+")"},beginAtZero:!0},y2:{position:"right",title:{display:!0,text:"Cumulative"},beginAtZero:!0,grid:{drawOnChartArea:!1}}}})})})]})})]})}export{at as default};
