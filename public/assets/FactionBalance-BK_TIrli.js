import{j as a,o as I}from"./index-BypqA20B.js";import{r as n}from"./vendor-react-BGsnWRWU.js";import{u as v}from"./useChartTheme-0-n_Utvk.js";import{f as A,C as B,a as _,L as k,P as N,b as O,p as R,c as T}from"./vendor-chart-BMU4AhuH.js";import{I as P}from"./InlineStat-aqVa0km5.js";import"./chartTheme-DLOnjtYC.js";B.register(_,k,N,O,R,T);function z({logsUpdated:g,darkMode:x,chartHeight:y=400,dateFrom:i,dateTo:r,onMinDate:c}){const[b,S]=n.useState({datasets:[]}),[C,o]=n.useState(!0),[j,w]=n.useState(!0),[D,E]=n.useState(null),{themedOptions:L}=v(x);return n.useEffect(()=>{async function l(){o(!0);const f=await I("LogsDB"),d="logs";if(!f.objectStoreNames.contains(d)){o(!1);return}const u=f.transaction(d).store.index("log"),p=await u.getAll(6738);p.push(...await u.getAll(6795));const e=[];for(const t of p)t.data&&typeof t.data.balance_after=="number"&&typeof t.timestamp=="number"&&e.push({x:t.timestamp,y:t.data.balance_after});e.sort((t,s)=>t.x-s.x);let m=e;if((i||r)&&(m=e.filter(t=>{const s=new Date(t.x*1e3).toISOString().slice(0,10);return!(i&&s<i||r&&s>r)})),e.length){const t=new Date(e[0].x*1e3).toISOString().slice(0,10);if(c&&/^\d{4}-\d{2}-\d{2}$/.test(t))try{c(t)}catch{}}S({datasets:[{label:"Balance",data:m,borderColor:"rgba(54, 162, 235, 0.9)",backgroundColor:"rgba(54, 162, 235, 0.3)",pointRadius:3,showLine:!0,fill:!1,tension:.2}]});let h=0;for(let t=1;t<e.length;t++){const s=e[t].y-e[t-1].y;s>0&&(h+=s)}E(h),o(!1)}l()},[g]),a.jsxs("div",{className:"my-4",children:[a.jsx("h5",{style:{cursor:"pointer",userSelect:"none"},onClick:()=>w(l=>!l),title:"Click to show/hide chart",children:"Faction balance"}),C?a.jsx("div",{children:a.jsx("img",{src:"/images/loader.gif",alt:"Chargement...",style:{maxWidth:"80px"}})}):j&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{height:y},children:a.jsx(A,{data:b,options:L({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0},title:{display:!1},tooltip:{enabled:!0}},scales:{x:{title:{display:!0,text:"Timestamp (Unix seconds)"},type:"linear",beginAtZero:!1},y:{title:{display:!0,text:"Balance"},beginAtZero:!0}}})})}),a.jsx(P,{id:"factionEarnedTotal",label:"Earned Total:",value:D})]})]})}export{z as default};
