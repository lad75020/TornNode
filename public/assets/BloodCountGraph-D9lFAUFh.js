import{j as a}from"./index-BypqA20B.js";import{r as i}from"./vendor-react-BGsnWRWU.js";import{f as H}from"./dateFilterUtil-DgyJ2LTd.js";import{u as J}from"./useChartTheme-0-n_Utvk.js";import{d as M,C as P,a as Q,L as U,B as X,p as Y,c as V}from"./vendor-chart-BMU4AhuH.js";import{I as tt}from"./InlineStat-aqVa0km5.js";import"./chartTheme-DLOnjtYC.js";P.register(Q,U,X,Y,V);function ut({logsUpdated:D,darkMode:w,chartHeight:S=400,dateFrom:B,dateTo:E,onMinDate:y}){const[v,W]=i.useState({datasets:[]}),[k,b]=i.useState(!0),[L,R]=i.useState(!0),[T,I]=i.useState(null),{themedOptions:N}=J(w);return i.useEffect(()=>{const u="LogsDB",p="logs",q=window.indexedDB.open(u);q.onsuccess=O=>{const x=O.target.result;if(!x.objectStoreNames.contains(p)){b(!1);return}const C=x.transaction(p,"readonly").objectStore(p).index("log"),l=[2340,2100],o={2340:{},2100:{}};let j=l.length;l.forEach(c=>{const A=IDBKeyRange.only(c),F=C.openCursor(A);F.onsuccess=K=>{const m=K.target.result;if(m){const s=m.value;if(typeof s.timestamp=="number"){const r=new Date(s.timestamp*1e3).toLocaleDateString();o[c][r]||(o[c][r]=0),o[c][r]++}m.continue()}else if(j--,j===0){const s={};[2340,2100].forEach(h=>{Object.keys(o[h]).forEach(d=>{s[d]||(s[d]=null)})});let r=l.length;l.forEach(h=>{const d=IDBKeyRange.only(h),_=C.openCursor(d);_.onsuccess=G=>{const g=G.target.result;if(g){const e=g.value;if(typeof e.timestamp=="number"){const n=new Date(e.timestamp*1e3).toLocaleDateString();(s[n]===null||e.timestamp<s[n])&&(s[n]=e.timestamp)}g.continue()}else if(r--,r===0){const e=Object.keys(s).map(t=>({day:t,ts:s[t]})).sort((t,f)=>t.ts-f.ts).map(t=>t.day),n=e.map(t=>o[2340][t]||0),Z=e.map(t=>o[2100][t]?-1*o[2100][t]:0);if(e.length&&y&&/^\d{4}-\d{2}-\d{2}$/.test(e[0]))try{y(e[0])}catch{}const $=H(e,[{label:"Withdrawal",data:n,backgroundColor:"rgba(54, 162, 235, 0.7)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1},{label:"Deposit",data:Z,backgroundColor:"rgba(255, 99, 132, 0.7)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1}],B,E);W($);const z=n.reduce((t,f)=>t+f,0);I(z),b(!1)}}})}}})}},[D]),a.jsxs("div",{className:"my-4",children:[a.jsx("h5",{style:{cursor:"pointer",userSelect:"none"},onClick:()=>R(u=>!u),title:"Click to show/hide chart",children:"Blood transactions"}),k?a.jsx("div",{children:a.jsx("img",{src:"/images/loader.gif",alt:"Chargement...",style:{maxWidth:"80px"}})}):L&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{height:S},children:a.jsx(M,{data:v,options:N({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0},title:{display:!1},tooltip:{enabled:!0}},scales:{x:{title:{display:!0,text:"Day"},type:"category"},y:{title:{display:!0,text:"Count"},beginAtZero:!0,type:"linear"}}})})}),a.jsx(tt,{id:"bloodTotalWithdrawals",label:"Total withdrawals:",value:T})]})]})}export{ut as default};
