import{j as o,o as O}from"./index-BypqA20B.js";import{r as f}from"./vendor-react-BGsnWRWU.js";import{u as D}from"./useChartTheme-0-n_Utvk.js";import{S as A,C as E,a as L,L as _,P as B,p as N,c as P}from"./vendor-chart-BMU4AhuH.js";import"./chartTheme-DLOnjtYC.js";E.register(L,_,B,N,P);const c={},R=s=>(c[s]||(c[s]=`hsl(${Object.keys(c).length*47%360}, 70%, 55%)`),c[s]);function z({logsUpdated:s,darkMode:g,chartHeight:x=400,dateFrom:i,dateTo:l,onMinDate:u}){const[y,C]=f.useState({datasets:[]}),[S,b]=f.useState(!0),{themedOptions:j}=D(g);return f.useEffect(()=>{async function p(){const d=await O("LogsDB"),h="logs";if(!d.objectStoreNames.contains(h))return;const k=await d.transaction(h).store.index("log").getAll(9005),a={};for(const t of k){const e=t.data&&t.data.crime?t.data.crime:"unknown",n=t.data&&typeof t.data.skill_level=="number"?t.data.skill_level:null;n!==null&&(a[e]||(a[e]=[]),a[e].push({x:t.timestamp,y:n}))}let r=null;for(const t of Object.values(a))for(const e of t)(r===null||e.x<r)&&(r=e.x);if(r&&u){const t=new Date(r*1e3).toISOString().slice(0,10);if(/^\d{4}-\d{2}-\d{2}$/.test(t))try{u(t)}catch{}}const w=Object.entries(a).map(([t,e])=>{const n=i||l?e.filter(v=>{const m=new Date(v.x*1e3).toISOString().slice(0,10);return!(i&&m<i||l&&m>l)}):e;return{label:t,data:n,backgroundColor:R(t),pointRadius:4}});C({datasets:w})}p()},[s,i,l,u]),o.jsxs("div",{className:"my-4",children:[o.jsx("h5",{style:{cursor:"pointer",userSelect:"none"},onClick:()=>b(p=>!p),title:"Click to show/hide chart",children:"Crime Skill Levels"}),S&&o.jsx("div",{style:{height:x},children:o.jsx(A,{data:y,options:j({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0},title:{display:!1},tooltip:{enabled:!0}},scales:{x:{title:{display:!0,text:"Timestamp (Unix seconds)"},type:"linear",beginAtZero:!1},y:{title:{display:!0,text:"Crime skills"},beginAtZero:!0}}})})})]})}export{z as default};
