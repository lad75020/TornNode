import{j as a,o as E}from"./index-BypqA20B.js";import{r as l}from"./vendor-react-BGsnWRWU.js";import{u as P}from"./useChartTheme-0-n_Utvk.js";import{f as v,C as G,T as O,L as B,P as I,b as N,p as T,c as j}from"./vendor-chart-BMU4AhuH.js";import"./chartTheme-DLOnjtYC.js";G.register(O,B,I,N,T,j);function M({logsUpdated:w,darkMode:D,chartHeight:L=400,dateFrom:o,dateTo:d,onMinDate:g}){const[h,_]=l.useState({datasets:[]}),[F,x]=l.useState(!0),[k,R]=l.useState(!0),{themedOptions:A,ds:s}=P(D);return l.useEffect(()=>{async function p(){x(!0);const y=await E("LogsDB"),b="logs";if(!y.objectStoreNames.contains(b))return;const r=y.transaction(b).store.index("log"),f=(await r.getAll(5302)).filter(t=>t.data&&typeof t.data.speed_after=="number").map(t=>({x:t.timestamp*1e3,y:t.data.speed_after})),u=(await r.getAll(5303)).filter(t=>t.data&&typeof t.data.dexterity_after=="number").map(t=>({x:t.timestamp*1e3,y:t.data.dexterity_after})),c=(await r.getAll(5300)).filter(t=>t.data&&typeof t.data.strength_after=="number").map(t=>({x:t.timestamp*1e3,y:t.data.strength_after})),m=(await r.getAll(5301)).filter(t=>t.data&&typeof t.data.defense_after=="number").map(t=>({x:t.timestamp*1e3,y:t.data.defense_after}));f.sort((t,e)=>t.x-e.x),u.sort((t,e)=>t.x-e.x),c.sort((t,e)=>t.x-e.x),m.sort((t,e)=>t.x-e.x);const C=[f,u,c,m];let i=null;if(C.some(t=>t.length)){const t=Math.min(...C.filter(e=>e.length).map(e=>e[0].x));isFinite(t)&&(i=new Date(t).toISOString().slice(0,10))}if(i&&g&&/^\d{4}-\d{2}-\d{2}$/.test(i))try{g(i)}catch{}function n(t){return!o&&!d?t:t.filter(e=>{const S=new Date(e.x).toISOString().slice(0,10);return!(o&&S<o||d&&S>d)})}_({datasets:[s("line",0,n(f),{label:"Speed",borderColor:"rgba(255, 165, 0, 0.9)",backgroundColor:"rgba(255, 165, 0, 0.3)",pointRadius:3,showLine:!0,fill:!1,tension:.2}),s("line",1,n(u),{label:"Dexterity",borderColor:"rgba(0, 123, 255, 0.9)",backgroundColor:"rgba(0, 123, 255, 0.3)",pointRadius:3,showLine:!0,fill:!1,tension:.2}),s("line",2,n(c),{label:"Strength",borderColor:"rgba(40, 167, 69, 0.9)",backgroundColor:"rgba(40, 167, 69, 0.3)",pointRadius:3,showLine:!0,fill:!1,tension:.2}),s("line",3,n(m),{label:"Defense",borderColor:"rgba(220, 53, 69, 0.9)",backgroundColor:"rgba(220, 53, 69, 0.3)",pointRadius:3,showLine:!0,fill:!1,tension:.2})]}),x(!1)}p()},[w]),a.jsxs("div",{children:[a.jsx("h5",{style:{cursor:"pointer",userSelect:"none"},onClick:()=>R(p=>!p),title:"Click to show/hide chart",children:"Gym stats"}),h.datasets.length===0?a.jsx("div",{children:a.jsx("img",{src:"/images/loader.gif",alt:"Chargement...",style:{maxWidth:"80px"}})}):k&&a.jsx("div",{style:{height:L},children:a.jsx(v,{data:h,options:A({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0},title:{display:!1},tooltip:{enabled:!0}},scales:{x:{type:"time",time:{unit:"day",tooltipFormat:"PPpp"},adapters:{},title:{display:!0,text:"Date"},ticks:{maxRotation:0,autoSkip:!0}},y:{title:{display:!0,text:"Value"},beginAtZero:!0}}})})})]})}export{M as default};
