import{j as r,o as R}from"./index-BypqA20B.js";import{r as n}from"./vendor-react-BGsnWRWU.js";import{f as W}from"./dateFilterUtil-DgyJ2LTd.js";import{u as k}from"./useChartTheme-0-n_Utvk.js";import{d as G,C as O,a as T,L as V,B as Z,p as $,c as q}from"./vendor-chart-BMU4AhuH.js";import"./chartTheme-DLOnjtYC.js";O.register(T,V,Z,$,q);function P({logsUpdated:S,darkMode:h,chartHeight:D=400,dateFrom:g,dateTo:b,onMinDate:l}){const[C,w]=n.useState({datasets:[]}),[B,c]=n.useState(!0),[L,N]=n.useState(!0),{ds:y,themedOptions:v}=k(h);return n.useEffect(()=>{async function m(){c(!0);const d=await R("LogsDB"),p="logs";if(!d.objectStoreNames.contains(p)){c(!1);return}const x=[8300,8301],a={8300:{},8301:{}};for(const t of x){const u=await d.transaction(p).store.index("log").getAll(t);for(const e of u)if(typeof e.timestamp=="number"&&e.data){const s=new Date(e.timestamp*1e3).toLocaleDateString();a[t][s]||(a[t][s]=0),t===8300?a[t][s]+=(Number(e.data.won_amount)||0)-(Number(e.data.bet_amount)||0):t===8301&&(a[t][s]+=-1*(Number(e.data.bet_amount)||0))}}const i={};for(const t of x){const u=await d.transaction(p).store.index("log").getAll(t);for(const e of u)if(typeof e.timestamp=="number"){const s=new Date(e.timestamp*1e3).toLocaleDateString();(i[s]===void 0||e.timestamp<i[s])&&(i[s]=e.timestamp)}}const o=Object.keys(i).map(t=>({day:t,ts:i[t]})).sort((t,f)=>t.ts-f.ts).map(t=>t.day);o.forEach(t=>{a[8300][t]>-1*a[8301][t]&&(a[8301][t]=0)});const A=o.map(t=>a[8300][t]||0),E=o.map(t=>a[8301][t]||0);if(o.length&&l&&/^\d{4}-\d{2}-\d{2}$/.test(o[0]))try{l(o[0])}catch{}const j={labels:o,datasets:[y("bar",0,A,{label:"Gain",borderWidth:1}),y("bar",1,E,{label:"Bets",borderWidth:1})]},_=W(j.labels,j.datasets,g,b);w(_),c(!1)}m()},[S,h,g,b,l]),r.jsxs("div",{className:"my-4",children:[r.jsx("h5",{style:{cursor:"pointer",userSelect:"none"},onClick:()=>N(m=>!m),title:"Click to show/hide chart",children:"Slots Results"}),B?r.jsx("div",{children:r.jsx("img",{src:"/images/loader.gif",alt:"Chargement...",style:{maxWidth:"80px"}})}):L&&r.jsx("div",{style:{height:D},children:r.jsx(G,{data:C,options:v({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0},title:{display:!1},tooltip:{enabled:!0}},scales:{x:{title:{display:!0,text:"Day"},type:"category"},y:{title:{display:!0,text:"Amount"},beginAtZero:!0,type:"linear"}}})})})]})}export{P as default};
