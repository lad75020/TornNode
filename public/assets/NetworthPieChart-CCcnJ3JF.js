import{j as t}from"./index-BypqA20B.js";import{r as u}from"./vendor-react-BGsnWRWU.js";import{u as A}from"./useChartTheme-0-n_Utvk.js";import{h as E,C as B,A as I,p as $,c as z}from"./vendor-chart-BMU4AhuH.js";import"./chartTheme-DLOnjtYC.js";B.register(I,$,z);function R({wsRef:d,wsMessages:l,sendWs:s,darkMode:b,chartHeight:w=420}){const{themedOptions:k,theme:x}=A(b),[p,N]=u.useState(null),m=u.useRef(!1);u.useEffect(()=>{function e(){if(d&&d.current&&d.current.readyState===1)try{s&&s("lastNetworth")}catch{}}m.current||(e(),m.current=!0);const r=setInterval(e,720*60*1e3);return()=>clearInterval(r)},[d,s]),u.useEffect(()=>{if(!l||l.length===0)return;const e=l[l.length-1];if(!(!e||!e.startsWith("{")))try{const r=JSON.parse(e);r&&r.type==="lastNetworth"&&r.networth&&!r.error&&N(r.networth)}catch{}},[l]);const{data:y,total:i,sortedParts:C}=u.useMemo(()=>{if(!p)return{data:null,total:0,sortedParts:[]};const e=[["Wallet","networthwallet"],["Vault","networthvault"],["Bank","networthbank"],["Cayman","networthcayman"],["Points","networthpoints"],["Items","networthitems"],["DisplayCase","networthdisplaycase"],["Bazaar","networthbazaar"],["ItemMarket","networthitemmarket"],["Properties","networthproperties"],["StockMarket","networthstockmarket"],["Auction","networthauctionhouse"],["Bookie","networthbookie"],["Company","networthcompany"],["EnlistedCars","networthenlistedcars"],["PiggyBank","networthpiggybank"],["Pending","networthpending"]],r=[];for(const[n,o]of e){const a=Number(p[o]);Number.isFinite(a)&&a!==0&&r.push({label:n,value:a,key:o})}const c=r.reduce((n,o)=>n+o.value,0),P=c*.01,h=[];let f=0;for(const n of r)n.value<P?f+=n.value:h.push(n);f>0&&h.push({label:"Other",value:f,key:"other"}),h.sort((n,o)=>o.value-n.value);const g=h.map(n=>n.label),S=h.map(n=>n.value),v=x.linePalette||[],j=g.map((n,o)=>{const a=v[o%v.length]||"#8884d8";return/rgba\(/.test(a)&&!/0\.7\)/.test(a)?a.replace(/\d?\.\d+\)$/,"0.7)"):a}),_=j.map(n=>{let o=n;return o=o.replace(/0\.7\)/,"1)").replace(/0\.6\)/,"1)").replace(/0\.5\)/,"1)"),o});return{total:c,sortedParts:r,data:{labels:g,datasets:[{label:"Networth distribution",data:S,backgroundColor:j,borderColor:_,borderWidth:1}]}}},[p,x]);return t.jsxs("div",{style:{height:w,display:"flex",flexDirection:"column",overflow:"hidden"},children:[t.jsxs("div",{style:{flex:"0 0 auto"},className:"d-flex align-items-center justify-content-between mb-1",children:[t.jsx("h5",{className:"m-0",style:{cursor:"pointer",userSelect:"none",fontSize:"1rem"},title:"Dernière répartition networth",children:"Networth Breakdown"}),t.jsx("div",{className:"btn-group btn-group-sm",children:t.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>{try{s("lastNetworth")}catch{}},title:"Rafraîchir",children:"↻"})})]}),y?t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{flex:1,minHeight:0,position:"relative"},children:t.jsx(E,{data:y,options:k({responsive:!0,maintainAspectRatio:!1,cutout:"55%",plugins:{legend:{position:"right",labels:{boxWidth:14}},tooltip:{callbacks:{label:e=>{const r=e.parsed||0,c=i?(r/i*100).toFixed(1):"0.0";return`${e.label}: ${r.toLocaleString()} (${c}%)`}}},title:{display:!0,text:`Total: ${i.toLocaleString()}`}}})})}),t.jsx("div",{style:{flex:"0 0 160px",overflowY:"auto",fontSize:12,marginTop:4,borderTop:"1px solid rgba(128,128,128,0.25)"},children:t.jsxs("table",{className:"table table-sm table-striped mb-0",style:{position:"relative"},children:[t.jsx("thead",{className:"sticky-top",style:{background:b?"#222":"#f8f9fa"},children:t.jsxs("tr",{children:[t.jsx("th",{children:"Part"}),t.jsx("th",{children:"Valeur"}),t.jsx("th",{children:"%"})]})}),t.jsx("tbody",{children:C.map(e=>{const r=i?(e.value/i*100).toFixed(2):"0.00";return t.jsxs("tr",{children:[t.jsx("td",{children:e.label}),t.jsx("td",{children:e.value.toLocaleString()}),t.jsxs("td",{children:[r,"%"]})]},e.key)})})]})})]}):t.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",padding:8},children:[t.jsx("div",{children:"Aucune donnée"}),t.jsx("button",{className:"btn btn-sm btn-outline-primary mt-2",onClick:()=>{try{s("lastNetworth"),m.current=!0}catch{}},children:"Refresh"})]})]})}export{R as default};
